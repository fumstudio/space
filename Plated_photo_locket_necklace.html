<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Keep your loved ones and happy memories close to your heart; they motivate you to succeed.
">
  <title>Steel flower photo locket</title>
  
  <!-- HTML -->
  

<link rel= "Shortcut icon" type="x-icon" href= "https://i.postimg.cc/XqrhcVpD/20240702-095704.png">

 <link rel="stylesheet" href="css/scale.css
    "> 
 <link href="https://fonts.google.com/share?selection.family=Jersey+25|Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">


   <!-- Custom Styles -->
<link rel="stylesheet" href="css/catalog.css
    "> 
<link rel="stylesheet" href="css/style1.css">
  <link rel="stylesheet" href="css/picture.css
  
    ">

<link rel="stylesheet" href="css/Product.css
    ">


  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9RJSDSSVMM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9RJSDSSVMM');
</script>
  
  <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MNW5B4W9');</script>
<!-- End Google Tag Manager -->

      <!-- links -->
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
     <script>
        $(function(){
            $("#navbar").load("navbar.html");
        });
    </script>
 <script>
        $(function(){
            $("#Whatsapp_button").load("whatsApp_button.html");
        });
    </script>
    <script>
        $(function(){
            $("#footer").load("footer.html");
        });
    </script>
         <script>
        $(function(){
            $("#Steel_plated_photo_locket").load("Set_Steel_plated_photo_locket.html");
        });
    </script>
        <script>
        $(function(){
            $("#tote_bag").load("Set_tote_bag.html");
        });
</script>

      <!-- Product -->
</head>

<body>
   
</main>
<div class="container2">
 <div class="menu-btn">
    <i class="fas fa-bars fa-2x"></i>
  </div>


    <!-- Nav -->
    <nav class="main-nav">
          <h1 alt="Microsoft" class="logo">
            <i class="fas fa-arrow-left back-button" onclick="goBack()"></i>

<script>
function goBack() {
    window.history.back();
}
</script>

&nbsp; Plated locket</h1>



       <div id="navbar"></div>
</div>
  <div class="container5">
    <div class="images5">
        <div class="image5"><img src="https://i.postimg.cc/PqvcdkGx/Untitled-design-10.jpg" alt="Image 1"></div>
        <div class="image5"><img src="https://i.postimg.cc/gJvT6q2b/Untitled-design-12.jpg" alt="Image 2"></div>
        
   <div class="image5"><img src="https://iili.io/dEVXgQS.jpg" alt="Image 3"></div>

</div>
    <div class="arrow left" onclick="slide(-1)">&lt;</div>
  <div class="arrow right" onclick="slide(1)">&gt;</div>
</div>
    </div>

  <div class="counter"></div>

  <script>
   let currentIndex = 0;
    const images = document.querySelectorAll('.image5');
    const counter = document.querySelector('.counter');
    let startX = 0;

    function updateCounter() {
      counter.textContent = `${currentIndex + 1} / ${images.length}`;
    }

    function slide(direction) {
      currentIndex = currentIndex + direction;
      if (currentIndex < 0) {
        currentIndex = images.length - 1;
      } else if (currentIndex >= images.length) {
        currentIndex = 0;
      }
      const offset = -currentIndex * 100;
      document.querySelector('.images5').style.transform = `translateX(${offset}%)`;
      updateCounter();
    }

    document.querySelector('.container5').addEventListener('touchstart', (event) => {
      startX = event.touches[0].clientX;
    });

    document.querySelector('.container5').addEventListener('touchend', (event) => {
      const endX = event.changedTouches[0].clientX;
      const diff = startX - endX;
      if (diff > 50) {
        slide(1); // Slide right
      } else if (diff < -50) {
        slide(-1); // Slide left
      }
    });

    updateCounter(); // Initial counter update
  </script>

 <div class="container slider-column">
<div class="top-section">
  
<div class="icon-container">
    <span id="heart" class="heart" onclick="toggleLike()">
        <i id="heartIcon" class="far fa-heart"></i>
    </span>
  

    <div id="share" class="share-icon">
        <i class="fas fa-share"></i>

    </div>
</div>
 <div class="numbers">
<span id="likes">Likes: 2</span><span id="likeCount"></span>

<script>
    document.getElementById('likes').style.color = 'gray';
</script>
</div>
<script>
let liked = false;
let likeCount = 0; // Set the initial like count here
const userId = 'user839'; // Replace this with a dynamic unique identifier for each user
const uniqueKey = `heartLikeStatus_${userId}`;

// Restore like status from local storage
function restoreLikeStatus() {
    const storedLiked = localStorage.getItem(uniqueKey + '.liked');
    const storedLikeCount = localStorage.getItem(uniqueKey + '.likeCount');

    if (storedLiked === 'true') {
        liked = true;
        likeCount = parseInt(storedLikeCount, 10) || likeCount; // Use stored count or initial count
        document.getElementById('heart').classList.add("liked");
    } else {
        likeCount = parseInt(storedLikeCount, 10) || likeCount; // Use stored count or initial count
    }

    // Increase the like count by 4 every page load
    likeCount += 2;

    // Update the displayed like count
    document.getElementById('likeCount').textContent = likeCount;

    // Save the updated like count to local storage
    localStorage.setItem(uniqueKey + '.likeCount', likeCount);
}

// Toggle like status
function toggleLike() {
    liked = !liked;
    likeCount += liked ? 1 : -1;
    const heart = document.getElementById('heart');
    heart.classList.toggle('liked', liked);
    document.getElementById('likeCount').textContent = likeCount;

    // Save state to local storage
    localStorage.setItem(uniqueKey + '.liked', liked);
    localStorage.setItem(uniqueKey + '.likeCount', likeCount);
}

// Restore like status on page load
window.onload = restoreLikeStatus;
</script>

</div>
  <script>
document.getElementById('share').addEventListener('click', function() {
    // Replace the placeholder URL and description with the actual values you want to share
    var url = encodeURIComponent('https://fumstudio.shop/Plated_photo_locket_necklace.html');
    var description = encodeURIComponent('Keep your loved ones and happy memories close to your heart; they motivate you to succeed.');
    window.open('https://api.whatsapp.com/send?text=' + description + '%0A' + url, '_blank');
});
</script>
<div class="top-section">
    <div class="p-4">
<span class="price" data-price="164.99">
    ZAR 164.99</span>

        <span class="free-shipping">Free Shipping ,SA</span>
        <p>3-7 business days.</p>
    <p>Keep your loved ones and happy memories close to your heart; they motivate you to succeed.</p>
        </div>

    <span class="clickable" onclick="toggleDetails()">Details</span>
    <div class="details" id="details">
        <p>Female,2 pictures (2cm),color: Antique Ivory,pendant: 2.5cm round circle, necklace sizes: 50cm,box color: PINK</p>
        
    </div>
  <br>

<button id="orderButton">ORDER NOW</button>
  </div>
<form id="orderForm">
    <div id="loadingScreen">Uploading... 0%</div>
                <div id="secondLoadingScreen">Processing... Please wait</div>
    <div id="controls">
        <div class="back">
  <div class="back">
          <div id="imageContainer">

        <i class="fas fa-image"></i>
        <p>Custom left photo</p>
    </div>
</div>
        <div class="slider-container">
            <div class="range-display">
                <label class="slider-label" for="zoomRange">Zoom</label>
                <input type="range" id="zoomRange" class="slider" min="1" max="3" step="0.1" value="1.5">
                <span id="zoomValue" class="range-value">1.5</span>
            </div>
            <div class="range-display">
                <label class="slider-label" for="moveX">Left  | right</label>
                <input type="range" id="moveX" class="slider" min="-100" max="100" step="1" value="0">
                <span id="moveXValue" class="range-value">0</span>
            </div>
            <div class="range-display">
                <label class="slider-label" for="moveY">Up | down</label>
                <input type="range" id="moveY" class="slider" min="-100" max="100" step="1" value="0">
                <span id="moveYValue" class="range-value">0</span>
            </div>
        </div>
        <button id="resetButton" class="reset-button hidden">Reset Image</button>
        <div id="buttonContainer">
            <button id="deleteButton" class="delete-button hidden">Delete Image</button>
            <button id="sendWhatsAppButton">
                <i class="fas fa-share"></i> Submit 
            </button>
            <input type="file" id="fileInput" style="display: none;">
            <label for="fileInput" id="uploadButton" class="custom-file-upload">
                <i class="fas fa-camera"></i> Upload Photo
            </label>
        </div>
      


    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-storage.js";

const firebaseConfig = {
    apiKey: "AlzaSyC9FWOWTpgSGUYhnjG4maMSt7SSj09hH-8",
    authDomain: "mvimsdetce.firebaseapp.com",
    projectId: "mvimsdetce",
    storageBucket: "myimages-de8ce.appspot.com",
    messagingSenderId: "501272670548",
    appId: "your_app_id",
    measurementId: "G-D24XGXB8DK"
};

const app = initializeApp(firebaseConfig);
const storage = getStorage(app);

document.addEventListener('DOMContentLoaded', () => {
    const fileInput = document.getElementById('fileInput');
    const uploadButton = document.getElementById('uploadButton');
    const imageContainer = document.getElementById('imageContainer');
    const sendWhatsAppButton = document.getElementById('sendWhatsAppButton');
    const deleteButton = document.getElementById('deleteButton');
    const resetButton = document.getElementById('resetButton');
    const loadingScreen = document.getElementById('loadingScreen');
    const secondLoadingScreen = document.getElementById('secondLoadingScreen');
    const zoomRange = document.getElementById('zoomRange');
    const moveX = document.getElementById('moveX');
    const moveY = document.getElementById('moveY');
    const zoomValue = document.getElementById('zoomValue');
    const moveXValue = document.getElementById('moveXValue');
    const moveYValue = document.getElementById('moveYValue');

    const LOCAL_STORAGE_PREFIX = '191_'; // Unique key prefix for local storage

    let uploadedImageUrl;
    let startX, startY, initialX, initialY, startDistance, initialScale, isDragging = false;

    // Load saved data from local storage
    loadSavedData();

    fileInput.addEventListener('change', handleFileSelect);
    resetButton.addEventListener('click', resetTransform);
    deleteButton.addEventListener('click', deleteImage);
    sendWhatsAppButton.addEventListener('click', sendWhatsAppMessage);

    zoomRange.addEventListener('input', applyTransform);
    moveX.addEventListener('input', applyTransform);
    moveY.addEventListener('input', applyTransform);

    imageContainer.addEventListener('touchstart', handleTouchStart);
    imageContainer.addEventListener('touchmove', handleTouchMove);
    imageContainer.addEventListener('touchend', handleTouchEnd);

    function handleFileSelect() {
        if (uploadedImageUrl) {
            alert('Only one picture is allowed to be uploaded. Please delete the existing picture to upload a new one.');
            fileInput.value = '';
            return;
        }

        const file = fileInput.files[0];
        if (file) {
            resizeImage(file).then(resizedBlob => {
                const storageRef = ref(storage, 'images/' + file.name);
                const uploadTask = uploadBytesResumable(storageRef, resizedBlob);

                uploadTask.on('state_changed', (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    loadingScreen.textContent = `Uploading... ${Math.round(progress)}%`;
                    loadingScreen.style.display = 'flex';
                }, (error) => {
                    console.error('Upload failed:', error);
                    loadingScreen.style.display = 'none';
                }, () => {
                    getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
                        uploadedImageUrl = downloadURL;
                        saveToLocalStorage('imageUrl', uploadedImageUrl);
                        saveToLocalStorage('zoomValue', zoomRange.value);
                        saveToLocalStorage('moveXValue', moveX.value);
                        saveToLocalStorage('moveYValue', moveY.value);

                        const imgElement = document.createElement('img');
                        imgElement.src = uploadedImageUrl;
                        imageContainer.innerHTML = '';
                        imageContainer.appendChild(imgElement);
                        loadingScreen.style.display = 'none';
                        
                        // Show the second loading screen
                        secondLoadingScreen.style.display = 'flex';

                        // Hide the second loading screen after 5 seconds
                        setTimeout(() => {
                            secondLoadingScreen.style.display = 'none';
                            applyTransform();
                        }, 5000);

                        uploadButton.style.display = 'none';
                        deleteButton.classList.remove('hidden');
                        sendWhatsAppButton.style.display = 'block';
                        resetButton.classList.remove('hidden');
                    });
                });
            });
        }
    }

    function resizeImage(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    let width = img.width;
                    let height = img.height;

                    if (width > height) {
                        if (width > 1024) {
                            height *= 1024 / width;
                            width = 1024;
                        }
                    } else {
                        if (height > 1024) {
                            width *= 1024 / height;
                            height = 1024;
                        }
                    }

                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);

                    canvas.toBlob((blob) => {
                        if (blob.size > 400 * 1024) {
                            const scaleFactor = Math.sqrt(400 * 1024 / blob.size);
                            const newWidth = Math.floor(width * scaleFactor);
                            const newHeight = Math.floor(height * scaleFactor);

                            const canvasScaled = document.createElement('canvas');
                            canvasScaled.width = newWidth;
                            canvasScaled.height = newHeight;
                            const ctxScaled = canvasScaled.getContext('2d');
                            ctxScaled.drawImage(canvas, 0, 0, newWidth, newHeight);

                            canvasScaled.toBlob(resolve, file.type);
                        } else {
                            resolve(blob);
                        }
                    }, file.type);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        });
    }

    function resetTransform() {
        zoomRange.value = 1.5;
        moveX.value = 0;
        moveY.value = 0;
        applyTransform();
        saveToLocalStorage('zoomValue', zoomRange.value);
        saveToLocalStorage('moveXValue', moveX.value);
        saveToLocalStorage('moveYValue', moveY.value);
    }

    function deleteImage() {
        imageContainer.innerHTML = '';
        uploadedImageUrl = null;
        removeFromLocalStorage('imageUrl');
        removeFromLocalStorage('zoomValue');
        removeFromLocalStorage('moveXValue');
        removeFromLocalStorage('moveYValue');
        fileInput.value = '';
        uploadButton.style.display = 'block';
        deleteButton.classList.add('hidden');
        sendWhatsAppButton.style.display = 'none';
        resetButton.classList.add('hidden');
    }

    function sendWhatsAppMessage() {
        if (uploadedImageUrl) {
            const zoom = zoomRange.value;
            const moveXValue = moveX.value;
            const moveYValue = moveY.value;
            const catalogLink = "https://fumstudio.shop/Photo_bracelet_&amp;amp&semi;_steel_necklace.html";
            const message = `Catalog Link , photo necklace: ${catalogLink}\n\nImage URL: ${uploadedImageUrl}\nZoom: ${zoom}\nLeft | Right: ${moveXValue}\nUp | Down: ${moveYValue}`;
            window.open(`https://wa.me/+27 62 617 2613?text=${encodeURIComponent(message)}`, '_blank');
        }
    }

    function applyTransform() {
        const imgElement = imageContainer.querySelector('img');
        if (imgElement) {
            imgElement.style.transform = `scale(${zoomRange.value}) translate(${moveX.value}px, ${moveY.value}px)`;
            zoomValue.textContent = zoomRange.value;
            moveXValue.textContent = moveX.value;
            moveYValue.textContent = moveY.value;

            // Save transformations to localStorage
            saveToLocalStorage('zoomValue', zoomRange.value);
            saveToLocalStorage('moveXValue', moveX.value);
            saveToLocalStorage('moveYValue', moveY.value);
        }
    }

    function handleTouchStart(e) {
        if (e.touches.length === 2) {
            const dx = e.touches[0].clientX - e.touches[1].clientX;
            const dy = e.touches[0].clientY - e.touches[1].clientY;
            startDistance = Math.sqrt(dx * dx + dy * dy);
            const imgElement = imageContainer.querySelector('img');
            initialScale = parseFloat(imgElement.style.transform.split('scale(')[1]) || 1;
        } else if (e.touches.length === 1) {
            isDragging = true;
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
            const imgElement = imageContainer.querySelector('img');
            initialX = parseFloat(imgElement.style.transform.split('translate(')[1].split(' ')[0]) || 0;
            initialY = parseFloat(imgElement.style.transform.split('translate(')[1].split(' ')[1].replace(')', '')) || 0;
        }
    }

    function handleTouchMove(e) {
        if (e.touches.length === 2) {
            const dx = e.touches[0].clientX - e.touches[1].clientX;
            const dy = e.touches[0].clientY - e.touches[1].clientY;
            const newDistance = Math.sqrt(dx * dx + dy * dy);
            const scale = initialScale * (newDistance / startDistance);
            zoomRange.value = scale;
            applyTransform();
        } else if (e.touches.length === 1 && isDragging) {
            const deltaX = e.touches[0].clientX - startX;
            const deltaY = e.touches[0].clientY - startY;
            moveX.value = initialX + deltaX;
            moveY.value = initialY + deltaY;
            applyTransform();
        }
    }

    function handleTouchEnd(event) {
        if (event.touches.length === 0) {
            isDragging = false;
        }
    }

    function loadSavedData() {
        const savedImageUrl = getFromLocalStorage('imageUrl');
        const savedZoomValue = getFromLocalStorage('zoomValue');
        const savedMoveXValue = getFromLocalStorage('moveXValue');
        const savedMoveYValue = getFromLocalStorage('moveYValue');

        if (savedImageUrl) {
            uploadedImageUrl = savedImageUrl;
            const imgElement = document.createElement('img');
            imgElement.src = uploadedImageUrl;
            imageContainer.innerHTML = '';
            imageContainer.appendChild(imgElement);

            if (savedZoomValue) {
                zoomRange.value = savedZoomValue;
            }
            if (savedMoveXValue) {
                moveX.value = savedMoveXValue;
            }
            if (savedMoveYValue) {
                moveY.value = savedMoveYValue;
            }

            applyTransform();
            uploadButton.style.display = 'none';
            deleteButton.classList.remove('hidden');
            sendWhatsAppButton.style.display = 'block';
            resetButton.classList.remove('hidden');
        }
    }

    function saveToLocalStorage(key, value) {
        localStorage.setItem(LOCAL_STORAGE_PREFIX + key, value);
    }

    function getFromLocalStorage(key) {
        return localStorage.getItem(LOCAL_STORAGE_PREFIX + key);
    }

    function removeFromLocalStorage(key) {
        localStorage.removeItem(LOCAL_STORAGE_PREFIX + key);
    }
});

   
    </script>
</div>
<br>


        <div id="loadingScreen">Uploading... 0%</div>
                <div id="secondLoadingScreen">Processing... Please wait</div>
    <div id="controls">
        <div class="back">
  <div class="back">
          <div id="imageContainer">

        <i class="fas fa-image"></i>
        <p>Custom right photo</p>
    </div>
</div>
        <div class="slider-container">
            <div class="range-display">
                <label class="slider-label" for="zoomRange">Zoom</label>
                <input type="range" id="zoomRange" class="slider" min="1" max="3" step="0.1" value="1.5">
                <span id="zoomValue" class="range-value">1.5</span>
            </div>
            <div class="range-display">
                <label class="slider-label" for="moveX">Left  | right</label>
                <input type="range" id="moveX" class="slider" min="-100" max="100" step="1" value="0">
                <span id="moveXValue" class="range-value">0</span>
            </div>
            <div class="range-display">
                <label class="slider-label" for="moveY">Up | down</label>
                <input type="range" id="moveY" class="slider" min="-100" max="100" step="1" value="0">
                <span id="moveYValue" class="range-value">0</span>
            </div>
        </div>
        <button id="resetButton" class="reset-button hidden">Reset Image</button>
        <div id="buttonContainer">
            <button id="deleteButton" class="delete-button hidden">Delete Image</button>
<button id="sendToWhatsAppButton">
    <i class="fas fa-share"></i> Submit 
</button>

            <input type="file" id="fileInput" style="display: none;">
            <label for="fileInput" id="uploadButton" class="custom-file-upload">
                <i class="fas fa-camera"></i> Upload Photo
            </label>
        </div>
    </div>

</form>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-storage.js";

const firebaseConfig = {
    apiKey: "AlzaSyC9FWOWTpgSGUYhnjG4maMSt7SSj09hH-8",
    authDomain: "mvimsdetce.firebaseapp.com",
    projectId: "mvimsdetce",
    storageBucket: "myimages-de8ce.appspot.com",
    messagingSenderId: "501272670548",
    appId: "your_app_id",
    measurementId: "G-D24XGXB8DK"
};

const app = initializeApp(firebaseConfig);
const storage = getStorage(app);

document.addEventListener('DOMContentLoaded', () => {
    const fileInput = document.getElementById('fileInput');
    const uploadButton = document.getElementById('uploadButton');
    const imageContainer = document.getElementById('imageContainer');
    const sendToWhatsAppButton = document.getElementById('sendToWhatsAppButton');
    const deleteButton = document.getElementById('deleteButton');
    const resetButton = document.getElementById('resetButton');
    const loadingScreen = document.getElementById('loadingScreen');
    const secondLoadingScreen = document.getElementById('secondLoadingScreen');
    const zoomRange = document.getElementById('zoomRange');
    const moveX = document.getElementById('moveX');
    const moveY = document.getElementById('moveY');
    const zoomValue = document.getElementById('zoomValue');
    const moveXValue = document.getElementById('moveXValue');
    const moveYValue = document.getElementById('moveYValue');

    let uploadedImageUrl;
    let startX, startY, initialX, initialY, startDistance, initialScale, isDragging = false;

    const storageKeyPrefix = 'myAppStorage133_'; // Unique identifier

    // Load saved image and transformations
    loadSavedData();

    fileInput.addEventListener('change', handleFileSelect);
    resetButton.addEventListener('click', resetTransform);
    deleteButton.addEventListener('click', deleteImage);
    sendToWhatsAppButton.addEventListener('click', sendWhatsAppMessage);

    zoomRange.addEventListener('input', applyTransform);
    moveX.addEventListener('input', applyTransform);
    moveY.addEventListener('input', applyTransform);

    imageContainer.addEventListener('touchstart', handleTouchStart);
    imageContainer.addEventListener('touchmove', handleTouchMove);
    imageContainer.addEventListener('touchend', handleTouchEnd);

    function handleFileSelect() {
        if (uploadedImageUrl) {
            alert('Only one picture is allowed to be uploaded. Please delete the existing picture to upload a new one.');
            fileInput.value = '';
            return;
        }

        const file = fileInput.files[0];
        if (file) {
            resizeImage(file).then(resizedBlob => {
                const storageRef = ref(storage, 'images/' + file.name);
                const uploadTask = uploadBytesResumable(storageRef, resizedBlob);

                uploadTask.on('state_changed', (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    loadingScreen.textContent = `Uploading... ${Math.round(progress)}%`;
                    loadingScreen.style.display = 'flex';
                }, (error) => {
                    console.error('Upload failed:', error);
                    loadingScreen.style.display = 'none';
                }, () => {
                    getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
                        uploadedImageUrl = downloadURL;
                        localStorage.setItem(storageKeyPrefix + 'imageUrl', uploadedImageUrl);
                        localStorage.setItem(storageKeyPrefix + 'zoomValue', zoomRange.value);
                        localStorage.setItem(storageKeyPrefix + 'moveXValue', moveX.value);
                        localStorage.setItem(storageKeyPrefix + 'moveYValue', moveY.value);

                        const imgElement = document.createElement('img');
                        imgElement.src = uploadedImageUrl;
                        imageContainer.innerHTML = '';
                        imageContainer.appendChild(imgElement);
                        loadingScreen.style.display = 'none';
                        
                        // Show the second loading screen
                        secondLoadingScreen.style.display = 'flex';

                        // Hide the second loading screen after 5 seconds
                        setTimeout(() => {
                            secondLoadingScreen.style.display = 'none';
                            applyTransform();
                        }, 5000);

                        uploadButton.style.display = 'none';
                        deleteButton.classList.remove('hidden');
                        sendToWhatsAppButton.style.display = 'block';
                        resetButton.classList.remove('hidden');
                    });
                });
            });
        }
    }

    function resizeImage(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    let width = img.width;
                    let height = img.height;

                    if (width > height) {
                        if (width > 1024) {
                            height *= 1024 / width;
                            width = 1024;
                        }
                    } else {
                        if (height > 1024) {
                            width *= 1024 / height;
                            height = 1024;
                        }
                    }

                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);

                    canvas.toBlob((blob) => {
                        if (blob.size > 400 * 1024) {
                            const scaleFactor = Math.sqrt(400 * 1024 / blob.size);
                            const newWidth = Math.floor(width * scaleFactor);
                            const newHeight = Math.floor(height * scaleFactor);

                            const canvasScaled = document.createElement('canvas');
                            canvasScaled.width = newWidth;
                            canvasScaled.height = newHeight;
                            const ctxScaled = canvasScaled.getContext('2d');
                            ctxScaled.drawImage(canvas, 0, 0, newWidth, newHeight);

                            canvasScaled.toBlob(resolve, file.type);
                        } else {
                            resolve(blob);
                        }
                    }, file.type);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        });
    }

    function resetTransform() {
        zoomRange.value = 1.5;
        moveX.value = 0;
        moveY.value = 0;
        applyTransform();
        localStorage.setItem(storageKeyPrefix + 'zoomValue', zoomRange.value);
        localStorage.setItem(storageKeyPrefix + 'moveXValue', moveX.value);
        localStorage.setItem(storageKeyPrefix + 'moveYValue', moveY.value);
    }

    function deleteImage() {
        imageContainer.innerHTML = '';
        uploadedImageUrl = null;
        localStorage.removeItem(storageKeyPrefix + 'imageUrl');
        localStorage.removeItem(storageKeyPrefix + 'zoomValue');
        localStorage.removeItem(storageKeyPrefix + 'moveXValue');
        localStorage.removeItem(storageKeyPrefix + 'moveYValue');
        fileInput.value = '';
        uploadButton.style.display = 'block';
        deleteButton.classList.add('hidden');
        sendToWhatsAppButton.style.display = 'none';
        resetButton.classList.add('hidden');
    }

    function sendWhatsAppMessage() {
        if (uploadedImageUrl) {
            const zoom = zoomRange.value;
            const moveXValue = moveX.value;
            const moveYValue = moveY.value;
            const catalogLink = "https://fumstudio.shop/Photo_bracelet_&amp;amp&semi;_steel_necklace.html";
            const message = `Catalog Link: photo set bracelet ${catalogLink}\n\nImage URL: ${uploadedImageUrl}\nZoom: ${zoom}\nLeft | Right: ${moveXValue}\nUp | Down: ${moveYValue}`;
            window.open(`https://wa.me/0659860276?text=${encodeURIComponent(message)}`, '_blank');
        }
    }

    function applyTransform() {
        const imgElement = imageContainer.querySelector('img');
        if (imgElement) {
            imgElement.style.transform = `scale(${zoomRange.value}) translate(${moveX.value}px, ${moveY.value}px)`;
            zoomValue.textContent = zoomRange.value;
            moveXValue.textContent = moveX.value;
            moveYValue.textContent = moveY.value;

            // Save transformations to localStorage
            localStorage.setItem(storageKeyPrefix + 'zoomValue', zoomRange.value);
            localStorage.setItem(storageKeyPrefix + 'moveXValue', moveX.value);
            localStorage.setItem(storageKeyPrefix + 'moveYValue', moveY.value);
        }
    }

    function handleTouchStart(e) {
        if (e.touches.length === 2) {
            const dx = e.touches[0].clientX - e.touches[1].clientX;
            const dy = e.touches[0].clientY - e.touches[1].clientY;
            startDistance = Math.sqrt(dx * dx + dy * dy);
            const imgElement = imageContainer.querySelector('img');
            initialScale = parseFloat(imgElement.style
.transform.match(/scale\(([^)]+)\)/)[1]);
        } else if (e.touches.length === 1) {
            const touch = e.touches[0];
            startX = touch.clientX;
            startY = touch.clientY;
            initialX = parseFloat(moveX.value);
            initialY = parseFloat(moveY.value);
            isDragging = true;
        }
    }

    function handleTouchMove(e) {
        const imgElement = imageContainer.querySelector('img');
        if (!imgElement) return;

        if (e.touches.length === 2 && startDistance) {
            const dx = e.touches[0].clientX - e.touches[1].clientX;
            const dy = e.touches[0].clientY - e.touches[1].clientY;
            const newDistance = Math.sqrt(dx * dx + dy * dy);
            const scale = (newDistance / startDistance) * initialScale;
            zoomRange.value = scale;
            applyTransform();
        } else if (e.touches.length === 1 && isDragging) {
            const touch = e.touches[0];
            const deltaX = touch.clientX - startX;
            const deltaY = touch.clientY - startY;
            moveX.value = initialX + deltaX;
            moveY.value = initialY + deltaY;
            applyTransform();
        }
    }

    function handleTouchEnd(e) {
        if (e.touches.length === 0) {
            isDragging = false;
        }
    }

    function loadSavedData() {
        const savedImageUrl = localStorage.getItem(storageKeyPrefix + 'imageUrl');
        if (savedImageUrl) {
            uploadedImageUrl = savedImageUrl;
            const imgElement = document.createElement('img');
            imgElement.src = uploadedImageUrl;
            imageContainer.innerHTML = '';
            imageContainer.appendChild(imgElement);

            zoomRange.value = localStorage.getItem(storageKeyPrefix + 'zoomValue') || 1.5;
            moveX.value = localStorage.getItem(storageKeyPrefix + 'moveXValue') || 0;
            moveY.value = localStorage.getItem(storageKeyPrefix + 'moveYValue') || 0;

            applyTransform();

            uploadButton.style.display = 'none';
            deleteButton.classList.remove('hidden');
            sendToWhatsAppButton.style.display = 'block';
            resetButton.classList.remove('hidden');
        }
    }
});
</script>
 </div> 
</div>

</section>
 
<p id="like" class="like">You might also like</p>
    <div class="scroll-indicator">

<div class="container3">

  <div class="product">
 <div id="Steel_plated_photo_locket"></div>
    </div>

  <div class="product">
 <div id="tote_bag"></div>
</div>
</div>
</div>



    </div>
 </div>
 <div id="Whatsapp_button"></div>
       <div id="footer"></div>
       </div></div>
 
<!-- partial -->
  <script src='https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js'></script><script  src="js/script.js"></script>


 <script src="js/main.js"></script>
  <script src="details_&amp;_button_slide.js"></script>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MNW5B4W9"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->


</body>
</html>